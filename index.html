<div class="shaka-video-container youtube-theme" data-shaka-player>
  <video id="video" autoplay muted playsinline preload="auto"></video>
  
</div>





<script>
const queryParams = new URLSearchParams(window.location.search);
        const url = queryParams.get('url');
        

    




    const channelstreamInfo = {  
      streamUrl: url,
      authBearer: "",   
      streamPoster: ""
    };

    let player;
    const video = document.getElementById('video');


const container = document.querySelector('.shaka-video-container');

    async function initializePlayer() {
      try {
        // Initialize Shaka Player first for better HLS support
        player = new shaka.Player();
  
  await player.attach(video);

  const ui = new shaka.ui.Overlay(player, container, video);
  
  // Custom UI configuration with seek bar colors
  const config = {
    'seekBarColors': {
      base: 'rgba(255,255,255,.2)',
      buffered: 'rgba(255,255,255,.4)',
      played: 'rgb(255,0,0)',
    },
    'controlPanelElements': [
      'play_pause',
      'time_and_duration',
      'mute',
      'volume',
      'spacer',
      'captions',
      'quality',
      'language',
      'picture_in_picture',
      'fullscreen', 
      'overflow_menu'
    ]
  };
  
  ui.configure(config);
  const controls = ui.getControls();

  // Optimized player configuration
  player.configure({
        
       streaming: {
  bufferingGoal: 30,// Increased from 30s to 120s
  rebufferingGoal: 150000,       // Increased from 5s to 15s
  bufferBehind: 6,          // Increased from 30s to 60s
  retryParameters: {
    timeout: 15000,
    maxAttempts: 3,
    baseDelay: 500,        
    backoffFactor: 1.5, 
bufferLength: 1, 
stableBufferTime: 1,
initialBitrate: 1, 
minBandwidth: 1,
default: 224
  },
  segmentRequestTimeout: 10000,
  useNativeHlsOnSafari: true
    },
    manifest: {
      retryParameters: {
        timeout: 10000,
        maxAttempts: 2
      }
    }
  });  

        // Set up network adapter for authorization
        const networkingEngine = player.getNetworkingEngine();
        networkingEngine.clearAllRequestFilters();
        networkingEngine.registerRequestFilter((type, request) => {
          if (channelstreamInfo.authBearer) {
            request.headers['Authorization'] = `Bearer ${channelstreamInfo.authBearer}`;
          }
        });

        // Set video properties for autoplay
        video.autoplay = true;
        video.controls = false;
        ui.getControls = true;
        video.volume = 1;
        video.muted = false;
        video.preload = 'auto';

        console.log(`Loading stream: ${channelstreamInfo.streamUrl}`);
        
        // Load the stream
        await player.load(channelstreamInfo.streamUrl);
        console.log('Stream loaded successfully.');

        // Force autoplay with multiple attempts
        const attemptAutoplay = async () => {
          try {
            await video.play();
            console.log('Autoplay successful');
          } catch (playError) {
            console.log('Autoplay blocked, trying with muted audio');
            video.muted = true;
            try {
              await video.play();
              console.log('Autoplay successful with muted audio');
            } catch (mutedError) {
              console.log('Autoplay failed completely, user interaction required');
            }
          }
        };

        // Immediate autoplay attempt
        if (video.readyState >= 2) {
          await attemptAutoplay();
        } else {
          video.addEventListener('canplay', attemptAutoplay, { once: true });
        }

      } catch (error) {
        console.error('Error initializing player:', error);
        
        // Fallback to direct video source
        video.src = channelstreamInfo.streamUrl;
        video.autoplay = true;
        video.muted = false;
        
        try {
          await video.play();
        } catch (fallbackError) {
          video.muted = true;
          await video.play();
        }
      }
    }

    // Initialize player when page loads
    document.addEventListener('DOMContentLoaded', () => {
      initializePlayer().catch(error => {
        console.error('Error initializing player:', error);
      });
    });

    // Keyboard controls
    document.addEventListener('keydown', event => {
      if (!video) return;

      switch (event.code) {
        case 'Space':
          event.preventDefault();
          video.paused ? video.play() : video.pause();
          break;
        case 'ArrowUp':
          event.preventDefault();
          video.volume = Math.min(video.volume + 0.1, 1);
          break;
        case 'ArrowDown':
          event.preventDefault();
          video.volume = Math.max(video.volume - 0.1, 0);
          break;
        case 'KeyF':
          if (document.fullscreenElement) {
            document.exitFullscreen();
          } else {
            video.requestFullscreen();
          }
          break;
        case 'KeyM':
          video.muted = !video.muted;
          break;
      }
    });


    
    
    
  

  </script>





















    <meta charset="UTF-8">
<meta name="referrer" content="no-referrer">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/shaka-player@4.13.3/dist/shaka-player.ui.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.6.0/shaka-player.ui.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.6.0/controls.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp">
  <style>

video {
        width: 100%;
        height: 100%;
        background-color: #000;
        display: block;
      }


      
      
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body {
      background: #000;
      height: 100%;
      width: 100%;
      overflow: hidden;
      font-family: system-ui, -apple-system, sans-serif;
    }
    .shaka-video-container {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
    }
    video {
      width: 100%;
      height: 100%;
      background: #000;
      object-fit: contain;
    }

        
      
    /* Manual play button styles */
    .manual-play-button {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 20px 30px;
      border-radius: 28px;
      cursor: pointer;
      font-size: 18px;
      z-index: 2000;
      border: 0px solid #ff0000;
      display: none;
      transition: all 0.3s ease;
    }
    
    .manual-play-button:hover {
      background: rgba(255, 0, 0, 0.8);
      transform: translate(-50%, -50%) scale(1.05);
    }
  </style>
