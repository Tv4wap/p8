<meta charset="UTF-8">
<meta name="referrer" content="no-referrer">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/shaka-player@4.13.3/dist/shaka-player.ui.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.6.0/shaka-player.ui.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.6.0/controls.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp">
  

<style type="text/css">
      body {position:absolute;
        margin: 0;
        padding: 0px;
        background-color: #000000;
        color: #fff;
        font-family: Arial, sans-serif;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        height:100%;width:100%
      }

      .video-container {
        position: absolute ;
        width: 100%;height:100%;
        aspect-ratio: 16/9;
        background-color: #000;
        border-radius: 1px;
        overflow: hidden;
        box-shadow: 0 4px 2px rgba(0,0,0,0.5);
      }

      .shaka-video-container {
        position: absolute ;
        width: 100%;height:100%;
        
        
      }

      video {
        width: 100%;
        height: 100%;
        background-color: #000;
        
      }

      .video-watermark {
        position: absolute;
        top: 15px;
        left: 15px;
        width: 80px;
        height: 10px;
        opacity: 0.7;
        z-index: 1000;
        pointer-events: none;
      }

      @media (max-width: 768px) {
        body {width:100%;height:100%
          padding: 1px;
        }
        
        .video-container {
          max-width: 100%;height:100%
        }
        
        .video-watermark {
          width: 30px;
          height: 30px;
          top: 10px;
          left: 10px;
        }
      }

      @media (min-width: 769px) and (max-width: 1024px) {
        .video-container {
          max-width: 854px;
        }
      }
</style>
                 

    
  


<div class="video-container">
<div class="shaka-video-container" data-shaka-player>
  <video id="video" autoplay muted playsinline preload="auto"></video>
</div>
</div>





<script>
const queryParams = new URLSearchParams(window.location.search);
        const url = queryParams.get('url');
        

    




    const channelstreamInfo = {  
      streamUrl: url,
      authBearer: "",   
      streamPoster: ""
    };

    let player;
    const video = document.getElementById('video');




    async function initializePlayer() {
      try {
        // Initialize Shaka Player first for better HLS support
        player = new shaka.Player();
  
  await player.attach(video);

  const container = document.querySelector('.shaka-video-container');
            
            const ui = new shaka.ui.Overlay(player, container, video);

            const config = {
                controlPanelElements: [
                    'play_pause',
                    'time_and_duration',
                    'mute',
                    
                    'spacer',
                    'captions',
                    'quality',
                    
                    'picture_in_picture',
                    'fullscreen',
                    'overflow_menu'
                ]
            };
            ui.configure(config);
  const controls = ui.getControls();

  // Optimized player configuration
  player.configure({
        
       streaming: {
  bufferingGoal: 30,// Increased from 30s to 120s
  rebufferingGoal: 150000,       // Increased from 5s to 15s
  bufferBehind: 6,          // Increased from 30s to 60s
  retryParameters: {
    timeout: 15000,
    maxAttempts: 3,
    baseDelay: 500,        
    backoffFactor: 1.5, 
bufferLength: 1, 
stableBufferTime: 1,
initialBitrate: 1, 
minBandwidth: 1,
default: 224
  },
  segmentRequestTimeout: 10000,
  useNativeHlsOnSafari: true
    },
    manifest: {
      retryParameters: {
        timeout: 10000,
        maxAttempts: 2
      }
    }
  });  

        // Set up network adapter for authorization
        const networkingEngine = player.getNetworkingEngine();
        networkingEngine.clearAllRequestFilters();
        networkingEngine.registerRequestFilter((type, request) => {
          if (channelstreamInfo.authBearer) {
            request.headers['Authorization'] = `Bearer ${channelstreamInfo.authBearer}`;
          }
        });

        // Set video properties for autoplay
        video.autoplay = true;
        video.controls = false;
        ui.getControls = true;
        video.volume = 1;
        video.muted = false;
        video.preload = 'auto';

        console.log(`Loading stream: ${channelstreamInfo.streamUrl}`);
        
        // Load the stream
        await player.load(channelstreamInfo.streamUrl);
        console.log('Stream loaded successfully.');

        // Force autoplay with multiple attempts
        const attemptAutoplay = async () => {
          try {
            await video.play();
            console.log('Autoplay successful');
          } catch (playError) {
            console.log('Autoplay blocked, trying with muted audio');
            video.muted = true;
            try {
              await video.play();
              console.log('Autoplay successful with muted audio');
            } catch (mutedError) {
              console.log('Autoplay failed completely, user interaction required');
            }
          }
        };

        // Immediate autoplay attempt
        if (video.readyState >= 2) {
          await attemptAutoplay();
        } else {
          video.addEventListener('canplay', attemptAutoplay, { once: true });
        }

      } catch (error) {
        console.error('Error initializing player:', error);
        
        // Fallback to direct video source
        video.src = channelstreamInfo.streamUrl;
        video.autoplay = true;
        video.muted = false;
        
        try {
          await video.play();
        } catch (fallbackError) {
          video.muted = true;
          await video.play();
        }
      }
    }

    // Initialize player when page loads
    document.addEventListener('DOMContentLoaded', () => {
      initializePlayer().catch(error => {
        console.error('Error initializing player:', error);
      });
    });

    

</script>
